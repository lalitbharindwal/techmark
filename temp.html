<script>
    // Check browser support
    if (!window.indexedDB) {
        alert("Sorry! Your browser does not support IndexedDB");
    }

let db;

// Open (or create) the database
function openDatabase() {
    return new Promise((resolve, reject) => {
        const dbName = "techmark";
        const dbVersion = 1;

        const request = indexedDB.open(dbName, dbVersion);

        request.onerror = function(event) {
            console.error("Database error: " + event.target.errorCode);
            reject(event.target.errorCode);
        };

        request.onsuccess = function(event) {
            db = event.target.result;
            console.log("Database opened successfully");
            resolve();
        };

        request.onupgradeneeded = function(event) {
            db = event.target.result;
            const objectStore = db.createObjectStore("techmark", { keyPath: "techmark", autoIncrement: true });

            // Create indexes for querying
            //objectStore.createIndex("cache", "cache", { unique: false });
            //objectStore.createIndex("email", "email", { unique: true });
            console.log("Object store created");
        };
    });
}

function updateData(updatedData) {
    const transaction = db.transaction(["techmark"], "readwrite");
    const objectStore = transaction.objectStore("techmark");

    const request = objectStore.put(updatedData);

    request.onsuccess = function(event) {
        console.log("Data updated successfully");
    };

    request.onerror = function(event) {
        console.error("Error updating data:", event.target.errorCode);
    };
}


// Function to add data to the database
function addData(data) {
    const transaction = db.transaction(["techmark"], "readwrite");
    const objectStore = transaction.objectStore("techmark");
    const request = objectStore.add(data);
    request.onsuccess = function(event) {
        console.log("Data added successfully");
    };

    request.onerror = function(event) {
        console.error("Error adding data: " + event.target.errorCode);
    };
}




// Open the database and then add/retrieve data
async function main() {
    try {
        await openDatabase();

        //addData({"email": "lalitbharindwal@gmail.com", "data": {"name": "lalits"}})
        updateData({"techmark":"techmark", "data": {"name": "lalits"}})
        const retrievedData = await getData("email");
        
        //const retrievedData = await getData(idToRetrieve);
    } catch (error) {
        console.error("Error in main function:", error);
    }
}

function getData(id) {
    return new Promise((resolve, reject) => {
        const transaction = db.transaction(["techmark"], "readonly");
        const objectStore = transaction.objectStore("techmark");

        const request = objectStore.get(id);

        request.onsuccess = function(event) {
            const result = event.target.result;
            console.log("Data retrieved successfully:", result);
            resolve(result);
        };

        request.onerror = function(event) {
            console.error("Error retrieving data: " + event.target.errorCode);
            reject(event.target.errorCode);
        };
    });
}


function deleteData(data) {
    const transaction = db.transaction(["techmark"], "readwrite");
    const objectStore = transaction.objectStore("techmark");

    const request = objectStore.delete(data);

    request.onsuccess = function(event) {
        console.log(`Data with email ${email} deleted successfully`);
    };

    request.onerror = function(event) {
        console.error(`Error deleting data with email ${email}: ${event.target.errorCode}`);
    };
}

// Call the main function to start the process
main();
</script>